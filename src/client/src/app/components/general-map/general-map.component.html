<section class="" [class]="openMenu ? 'open map-container' : 'map-container' ">
  <div [class]="classes">
    <ol-map [lat]="-16.6958288" [lon]="-49.4443537" [zoom]="4.6" [width]="'100%'" [height]="'100vh'"
      (onReady)="setMap($event)">
      <ol-control control="FullScreen" [options]="{ source:'main'}">
      </ol-control>
      <ol-control control="ScaleLine" [options]="options">
      </ol-control>
      <ol-control control="mouseposition" [options]="mousePositionOptions">
      </ol-control>
      <ol-control control="Zoom">
      </ol-control>

      <!-- add graticule-->
      <ol-layer [layer]="graticule"></ol-layer>

      <!-- add layers-->
      <ol-layer *ngFor="let layer of layers" [layer]="layer"></ol-layer>

      <ol-map-marker *ngIf="!showFormPoint && lat && lon" [lat]="lat" [lon]="lon"
        [text]="'Lat: ' + lat + '\nLon: ' + lon"></ol-map-marker>
      <div *ngIf="showFormPoint" class="search-point">
        <div class="search-point-container">
          <span class="p-float-label">
            <input type="number" id="lat" pInputText [(ngModel)]="lat">
            <label for="lat">Latitude</label>
          </span>
          <span class="p-float-label">
            <input type="number" id="lon" pInputText [(ngModel)]="lon">
            <label for="lat">Longitude</label>
          </span>
          <i (click)="searchPoint()" class='fg-location-on fg-lg'></i>
        </div>
      </div>
      <div class="coordinates">
        <div class="coordinates-container">
          <i (click)="showFormPoint = !showFormPoint" tooltipPosition="left" [pTooltip]="'map.find_point' | translate"
            class='fg-search-poi fg-lg'></i>
          <div id="coordinates-label" class="mouse-position"></div>
        </div>
      </div>
      <div *ngIf="this.selectedLayers.length > 0"  [class]="legendExpanded ? 'legends' : 'legends legends-expanded'">
        <div class="legends-container">
          <div class="legends-header">
            <h5>{{'legend.title' | translate}}</h5>
            <i  [pTooltip]="legendExpanded? localizationService.translate('minimize') : localizationService.translate('maximize')" (click)="legendExpanded = !legendExpanded" [class]="legendExpanded ? 'bx bx-collapse' : 'bx bx-expand'"></i>
          </div>
          <div class="legends-body" cdkDropList (cdkDropListDropped)="drop($event)">
            <div *ngFor="let layer of selectedLayers" cdkDrag
              [class]="layer.visible ? 'legend-card legend-card-active' :'legend-card'">
              <div class="legend-card-content">
                <div (click)="layer.visible = !layer.visible" class="abstract">
                  <span>
                    <i tooltipPosition="left" pTooltip="{{'legend.move' | translate}}" class='bx bx-move'></i>
                    <div class="legend-label">
                      {{ layer.get('key') === 'planet' ? localizationService.translate('planet') : layer.get('label') }}
                    </div>
                    <i tooltipPosition="left" [pTooltip]="layer.visible? localizationService.translate('minimize') : localizationService.translate('maximize')" [class]="layer.visible  ? 'bx bxs-up-arrow-circle' :'bx bxs-down-arrow-circle'"></i>
                  </span>
                </div>
                <div class="details" *ngIf="layer.get('key') !== 'planet'">
                  <div class="details-inner">
                    <img
                      src="https://ows.lapig.iesa.ufg.br/ows?EXCEPTIONS=application%2Fvnd.ogc.se_xml&TRANSPARENT=TRUE&VERSION=1.1.1&SERVICE=WMS&REQUEST=GetLegendGraphic&layer={{layer.get('key')}}&format=image%2Fpng"
                      alt="">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="controls">
        <div class="controls-container">
          <i pRipple [pTooltip]="'controls.swipe' | translate"
            [class]="mapControls.swipe ? 'fg-flip-h control-active' : 'fg-flip-h'"
            (click)="onSwipe()"></i>
          <i pRipple [pTooltip]="'controls.point' | translate"
            [class]="mapControls.point ? 'fg-location-poi-o control-active' : 'fg-location-poi-o'"
            (click)="onPoint()"></i>
          <i pRipple [pTooltip]="'controls.draw' | translate"
            [class]="mapControls.drawArea ? 'fg-polygon-pt control-active' : 'fg-polygon-pt'" (click)="onPolygon()"></i>
          <i pRipple [pTooltip]="'controls.measure' | translate"
            [class]="mapControls.measure ? 'fg-measure control-active' : 'fg-measure'" (click)="onRuler()"></i>
          <i pRipple [pTooltip]="'controls.measureArea' | translate"
            [class]="mapControls.measureArea ? 'fg-measure-area control-active' : 'fg-measure-area'"
            (click)="onRulerArea()"></i>
<!--          <i pRipple [pTooltip]="'controls.print' | translate"-->
<!--            [class]="mapControls.print ? 'bx bxs-file-pdf control-active' : 'bx bxs-file-pdf'"></i>-->
        </div>
      </div>
      <div *ngIf="controlOptions" class="controls-details">
        <div class="controls-details-header">
          <h5>{{'controls.details.title' | translate}}</h5>
          <i (click)="controlOptions = !controlOptions" class='bx bx-x-circle'></i>
        </div>
        <div class="controls-details-body">
          <div *ngIf="mapControls.swipe" class="controls-details-card">
            <div class="controls-details-card-title">{{'controls.swipe' | translate}}</div>
            <div class="controls-details-card-body">
              <span>
                <p-autoComplete
                  (onClear)="onClearSwipe($event)"
                  [appendTo]="'body'"
                  [placeholder]="'controls.details.swipe_placeholder' | translate"
                  [(ngModel)]="valueSwipe"
                  [suggestions]="swipeOptions"
                  (onSelect)="onSwipeSelectedLayer($event)"
                  (completeMethod)="search($event)"
                  field="name"
                >
                  <ng-template let-layer pTemplate="item">
                    <div class="autocomplete-option">{{layer.name}}</div>
                  </ng-template>
                </p-autoComplete>
                <div class="controls-details-card-body-actions">
                  <i *ngIf="valueSwipe" [pTooltip]="'controls.details.clear' | translate" class='bx bx-trash' (click)="onClearSwipe($event)"></i>
                </div>
              </span>
              <div class="layer-card-body" *ngIf="swipeLayer.visible">
                <div class="layer-card-content">
                  <div *ngIf="swipeLayer.types">
                        <span class="p-float-label" *ngFor="let type of swipeLayer?.types"
                              [hidden]="type.value != swipeLayer.selectedType">
                          <p-dropdown id="types-{{type.value}}" *ngIf="swipeLayer.types.length > 0" [options]="swipeLayer.types"
                                      [(ngModel)]="swipeLayer.selectedType" (onChange)="changeLayerVisibility(type)"
                                      optionLabel="Viewvalue" optionValue="value"></p-dropdown>
                          <label for="types-{{type.value}}">{{type.typeLabel}}</label>
                        </span>
                    <span *ngFor="let type of swipeLayer.types" [hidden]="type.value != swipeLayer.selectedType"
                          class="p-float-label">
                          <p-dropdown id="types-times-{{type.value}}" *ngIf="type.times" [options]="type.times"
                                      [(ngModel)]="type.timeSelected" (onChange)="changeLayerVisibility({layer: type, updateSource: true})"
                                      optionLabel="Viewvalue" optionValue="value"></p-dropdown>
                          <label for="types-times-{{type.value}}">{{type.timeLabel}}</label>
                        </span>
                  </div>
                  <span class="p-float-label" *ngIf="swipeLayer.times">
                      <p-dropdown id="swipe-times-{{swipeLayer.id}}" *ngIf="swipeLayer.times.length > 0" [options]="swipeLayer.times"
                                  [(ngModel)]="swipeLayer.timeSelected" (onChange)="changeLayerVisibility({layer: swipeLayer, updateSource: true})"
                                  optionLabel="Viewvalue" optionValue="value">
                      </p-dropdown>
                      <label for="swipe-times-{{swipeLayer.id}}">{{swipeLayer.timeLabel}}</label>
                  </span>
                </div>
              </div>
            </div>
          </div>
          <div *ngIf="mapControls.search" class="controls-details-card">
            <div class="controls-details-card-title">{{'controls.search' | translate}}</div>
            <div class="controls-details-card-body">
              <div id="search-options" class="search-options">
                <div class="search-options-title">
                  {{'controls.filter_texts.search_lateral_title' | translate}}
                </div>
                <mat-button-toggle-group appearance="legacy" #group="matButtonToggleGroup"
                  [(ngModel)]="selectedSearchOption" (change)="onChangeSearchOption()">
                  <mat-button-toggle *ngFor="let option of searchOptions" value="{{option.value}}"
                    aria-label="{{option.label}}">
                    <mat-icon>{{option.icon}}</mat-icon> {{option.label}}
                  </mat-button-toggle>
                </mat-button-toggle-group>
              </div>
              <span>
                <p-autoComplete
                  (onClear)="onClearFilter($event)"
                  [appendTo]="'body'"
                  [placeholder]="textsComponentesFilters.search_placeholder"
                  [(ngModel)]="selectedAutoCompleteText"
                  [suggestions]="listForAutoComplete"
                  (completeMethod)="obtainSearchSuggestions($event)"
                  (onSelect)="onSelectSuggestion($event)"
                  [emptyMessage]="textsComponentesFilters.search_failed"
                  [showEmptyMessage]="true"
                  field="text" styleClass="wid100"
                >
                  <ng-template let-result pTemplate="item">
                    <div class="autocomplete-option">{{result.text}}</div>
                  </ng-template>
                </p-autoComplete>
                <i *ngIf="selectedAutoCompleteText?.text" [pTooltip]="'controls.details.clear' | translate"
                  class='close bx bx-x-circle' (click)="updateRegion(defaultRegion)"></i>
              </span>

            </div>
          </div>
          <div *ngIf="(mapControls.drawArea || this.mapControls.point) && features.length > 0"
            class="controls-details-card">
            <div class="controls-details-card-title">{{'controls.draw_area.title' | translate}}</div>
            <div class="controls-details-card-body">
              <div class="features grid">
                <div class="card-feature col-fixed" *ngFor="let feat of features; let i = index"
                  (mouseenter)="onHoverFeature(feat)" (mouseleave)="onHoverFeature(feat, true)">
                  <div class="card-feature-title">
<!--                    <span>{{feat.get('id')}}</span>-->
                    <span translate="controls.draw_area.feature.{{feat.getGeometry().getType().toLowerCase()}}"></span>
                  </div>
                  <div class="card-feature-actions">
<!--                    <i class='bx bx-plus-medical' (click)="onAddPropertyFeature(i, feat)"></i>-->
                    <i class='bx bx-trash remove' pTooltip="{{'controls.draw_area.feature.remove_feature' | translate}}" (click)="onRemoveFeature(i, feat)"></i>
                  </div>
                </div>
              </div>
              <div *ngIf="features.length > 0" class="features-actions">
                <div pRipple class="btn-action btn-save" (click)="onSave()">
                  <i class='bx bx-save'></i>
                  <span>{{'controls.draw_area.save' | translate}}</span>
                </div>
                <div pRipple class="btn-action btn-cancel"  (click)="onCancel()">
                  <i class='bx bx-trash'></i>
                  <span>{{'controls.draw_area.cancel' | translate}}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </ol-map>
  </div>
</section>
